<!DOCTYPE html>
<html>
<head>
<title>Sapi frontend</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<script src="http://ajax.aspnetcdn.com/ajax/jquery/jquery-1.9.0.js"></script>
<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-3.0.0.js"></script>
</head>
<body>
    <div class="navbar">
        <div class="navbar-inner">
            <a class="brand" href="#">Sapi frontend</a>
        </div>
    </div>
    <div id="main" class="container">
        <table class="table table-striped table-hover table-condensed">
        <tbody data-bind="foreach: samples">
            <tr>
                <td><p data-bind="text: name"></p></td>
                <td><p data-bind="text: init"></p></td>
                <td><p data-bind="text: splits"></p></td>
                <td><p data-bind="text: sais"></p></td>
                <td><p data-bind="text: sampe"></p></td>
                <td><p data-bind="text: merge"></p></td>
                <td><p data-bind="text: dups"></p></td>
                <td><p data-bind="text: stats"></p></td>
            </tr>
        </tbody>
        </table>
    </div>

    <script type="text/javascript">
function SamplesViewModel() {
    var self = this;
    self.URI = 'http://localhost:5000/sapi/api/v1.0/samples';
    self.samples = ko.observableArray();

    self.ajax = function(uri, method, data) {
        var request = {
            url: uri,
            type: method,
            contentType: "application/json",
            accepts: "application/json",
            cache: false,
            dataType: 'json',
            data: JSON.stringify(data),
            /*
            beforeSend: function (xhr) {
                xhr.setRequestHeader("Authorization",
                    "Basic " + btoa(self.username + ":" + self.password));
            },
            */
            error: function(jqXHR) {
                console.log("ajax error " + jqXHR.status);
            }
        };
        return $.ajax(request);
    }

    function create_sampe(sample) {
        return {
            name: sample.name,
            init: "init",
            splits: "splits",
            sais: "sais",
            sampe: "sampe",
            merge: "X",
            dups: "X",
            stats: "X",
        }
    }

    self.ajax(self.URI, 'GET').done(function(data) {
        for (var i=0; i<data.samples.length; i++) {
            self.samples.push(create_sampe(data.samples[i]));
        }
    });
}

ko.applyBindings(new SamplesViewModel());
    </script>

</body>
</html>
